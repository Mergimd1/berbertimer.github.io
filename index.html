<style>
    .time-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-bottom: 20px;
    }
    .time-btn {
        background: white;
        color: black;
        padding: 10px;
        border-radius: 8px;
        font-weight: bold;
        text-align: center;
        border: 1px solid #ddd;
    }
    .time-btn.selected {
        background: #0f172a;
        color: #fbbf24;
        border-color: #fbbf24;
    }
    #map-preview {
        height: 150px;
        background: #1e293b;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        border: 1px dashed #fbbf24;
        cursor: pointer;
    }
</style>

<div id="booking-modal">
    <div class="glass-card p-6 w-[95%] max-w-md overflow-y-auto max-h-[90vh]">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-black italic">ZGJEDH SHÃ‹RBIMIN</h2>
            <button onclick="closeBooking()"><i class="fa-solid fa-xmark text-2xl"></i></button>
        </div>

        <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
            <button class="bg-slate-800 px-4 py-2 rounded-lg text-xs font-bold border border-yellow-400">Die 1</button>
            <button class="bg-white text-black px-4 py-2 rounded-lg text-xs font-bold">HÃ«n 2</button>
            <button class="bg-white text-black px-4 py-2 rounded-lg text-xs font-bold">Mar 3</button>
            <button class="bg-white text-black px-4 py-2 rounded-lg text-xs font-bold">MÃ«r 4</button>
        </div>

        <div class="time-grid">
            <button class="time-btn" onclick="selectTime(this)">09:00</button>
            <button class="time-btn" onclick="selectTime(this)">10:30</button>
            <button class="time-btn" onclick="selectTime(this)">12:00</button>
            </div>

        <div id="map-preview" onclick="getLocation()">
            <div class="text-center">
                <i class="fa-solid fa-map-location-dot text-2xl text-yellow-400 mb-1"></i>
                <p class="text-[10px] uppercase font-bold" id="location-text">Kliko pÃ«r tÃ« zgjedhur lokacionin</p>
            </div>
        </div>

        <input type="text" id="name" placeholder="Emri juaj" class="input-style">
        <input type="tel" id="phone" placeholder="Nr. Telefonit" class="input-style">

        <button onclick="sendFinalBooking()" class="w-full bg-emerald-500 py-4 rounded-xl font-black uppercase tracking-widest text-white shadow-lg mt-2">
            KONFIRMO
        </button>
    </div>
</div>

<script>
    let selectedTime = "";
    let userLocation = "";

    function selectTime(btn) {
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedTime = btn.innerText;
    }

    // Funksioni pÃ«r tÃ« marrÃ« lokacionin nga Google Maps
    function getLocation() {
        if (navigator.geolocation) {
            document.getElementById('location-text').innerText = "Duke kÃ«rkuar lokacionin...";
            navigator.geolocation.getCurrentPosition(function(position) {
                userLocation = `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`;
                document.getElementById('location-text').innerText = "Lokacioni u regjistrua âœ…";
                document.getElementById('map-preview').style.borderColor = "#4ade80";
            }, function() {
                alert("Ju lutem lejoni qasjen nÃ« lokacion qÃ« t'ju gjejÃ« berberi!");
            });
        }
    }

    async function sendFinalBooking() {
        const emri = document.getElementById('name').value;
        const tel = document.getElementById('phone').value;
        
        if(!selectedTime || !emri || !tel || !userLocation) {
            alert("PlotÃ«soni tÃ« gjitha, pÃ«rfshirÃ« lokacionin!");
            return;
        }

        // Krijon linkun pÃ«r Google Calendar
        const googleCalLink = `https://www.google.com/calendar/render?action=TEMPLATE&text=Qethje+me+Mergimin&details=Klienti:+${emri}+Tel:+${tel}&location=${encodeURIComponent(userLocation)}`;

        const mesazhi = `ğŸ“… *REZERVIM I RI GOOGLE* ğŸ“…\n\nğŸ‘¤ Klienti: ${emri}\nğŸ“ Tel: ${tel}\nâ° Ora: ${selectedTime}\nğŸ“ Lokacioni (Maps): ${userLocation}\n\nğŸ—“ï¸ [Shto nÃ« Calendar](${googleCalLink})`;

        // Kodi i dÃ«rgimit nÃ« Telegram (si mÃ« parÃ«)
        // fetch(url)...
        
        alert("Rezervimi u dÃ«rgua! Mergimi do tÃ« vijÃ« nÃ« lokacionin tuaj.");
        closeBooking();
    }
</script>

